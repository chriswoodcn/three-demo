<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="Build/CesiumUnminified/Cesium.js"></script>
    <link rel="stylesheet" href="Build/Cesium/Widgets/widgets.css" />
    <script src="initMap.js"></script>
    <script>
      //在initMap.js进行初始化
      var viewer = null;
      function load() {
        console.log("地图初始化");
        initMap();
      }
      //采集点
      var gatherPoint = null;
      //事件对象
      var handler = null;
      function gatherPointFun() {
        gatherPoint = null;
        handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);
        //鼠标变成加号
        document.getElementById("map").style.cursor = "crosshair";
        // 对鼠标按下事件的监听
        handler.setInputAction(function (event) {
          console.log("点击事件event：", event);
          //获取加载地形后对应的经纬度和高程：地标坐标
          var ray = viewer.camera.getPickRay(event.position);
          var cartesian = viewer.scene.globe.pick(ray, viewer.scene);
          //获取倾斜摄影或模型点击处的坐标：场景坐标
          //var cartesian = viewer.scene.pick(event.position);
          console.log("cartesian:", cartesian);
          if (!Cesium.defined(cartesian)) {
            return;
          }
          gatherPoint = viewer.entities.add({
            name: "point",
            position: cartesian,
            point: {
              color: Cesium.Color.CHARTREUSE.withAlpha(1),
              pixelSize: 10,
              heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
              outlineColor: Cesium.Color.WHITE,
              outlineWidth: 1,
            },
          });
          //笛卡尔坐标转经纬度坐标
          var ellipsoid = viewer.scene.globe.ellipsoid;
          var cartographic = ellipsoid.cartesianToCartographic(cartesian);
          var obj = {};
          obj.lat = Cesium.Math.toDegrees(cartographic.latitude);
          obj.lng = Cesium.Math.toDegrees(cartographic.longitude);
          obj.alt = cartographic.height;
          console.log("采集的面坐标(经纬度)", obj);
          //鼠标变成默认
          document.getElementById("map").style.cursor = "default";
          //移除地图点击事件
          handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK); //移除事件
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
      }
    </script>
  </head>
  <body onload="load()">
    <input
      type="button"
      value="点采集(经纬度、高度)"
      onclick="gatherPointFun()"
      style="
        position: absolute;
        left: 50px;
        top: 50px;
        background: blue;
        color: white;
        z-index: 9999;
      "
    />
    <div
      id="map"
      style="
        z-index: 100;
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
      "
    ></div>
  </body>
</html>
